{% extends 'accounts/base.html' %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<style>
  body {
    background-color: #f4f9f4;
    color: #1b5e20;
    font-family: Arial, sans-serif;
  }

  h2 {
    text-align: center;
    margin-bottom: 30px;
    font-weight: bold;
    color: #1b5e20;
  }

  .card {
    border: none;
    border-radius: 10px;
    transition: 0.3s;
    cursor: pointer;
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  .summary-card {
    background-color: #1b5e20;
    color: #fff;
  }

  .summary-card h4 {
    font-size: 2rem;
    margin: 0;
  }

  .summary-card p {
    font-size: 0.9rem;
    opacity: 0.9;
  }

  table {
    background-color: #fff;
  }

  .table thead {
    background-color: #c8e6c9;
    color: #1b5e20;
  }

  .section-title {
    color: #1b5e20;
    border-left: 5px solid #1b5e20;
    padding-left: 10px;
    margin: 40px 0 15px 0;
    font-weight: bold;
  }

  .approval-section .card {
    background-color: #f9f9f9;
    border: 1px solid #c8e6c9;
  }

  .approval-section h5 {
    color: #1b5e20;
    font-weight: bold;
  }

  ul {
    list-style: none;
    padding: 0;
  }

  ul li {
    background-color: #e8f5e9;
    margin-bottom: 6px;
    padding: 6px 10px;
    border-radius: 5px;
  }

  .logout-btn {
    background-color: #1b5e20;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    text-decoration: none;
  }

  .logout-btn:hover {
    background-color: #2e7d32;
  }

  html {
    scroll-behavior: smooth;
  }

  /* Dropdown animation */
  .collapsible-content {
    display: none;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .dropdown-btn {
    background-color: #1b5e20;
    color: #fff;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    text-align: left;
  }

  .dropdown-btn:hover {
    background-color: #2e7d32;
  }

</style>

<h2>Admin Dashboard</h2>

<!-- Summary Cards -->
<div class="row text-center mb-4">
  <div class="col-md-3 mb-3">
    <div class="card summary-card p-3" onclick="toggleDropdown('users-section')">
      <h4>{{ total_students }}</h4>
      <p>Students</p>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="card summary-card p-3">
      <h4>{{ total_lecturers }}</h4>
      <p>Lecturers</p>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="card summary-card p-3">
      <h4>{{ total_admins }}</h4>
      <p>Admins</p>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="card summary-card p-3">
      <h4>{{ total_users }}</h4>
      <p>Total Users</p>
    </div>
  </div>
</div>

<!-- Manage Users Dropdown -->
<h4 id="users-section" class="section-title">Manage Users</h4>

<form method="get" class="mb-3 d-flex">
  <input type="text" name="search" class="form-control me-2"
         placeholder="Search by name or email"
         value="{{ search_query }}">
  <button type="submit" class="btn btn-success">Search</button>
</form>

<div class="table-responsive">
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Email</th>
        <th>Role</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.first_name }}</td>
        <td>{{ user.last_name }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.role }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" class="text-center">No users found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination Controls -->
<nav aria-label="User pagination">
  <ul class="pagination justify-content-center">
    {% if users.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ users.previous_page_number }}&search={{ search_query }}">Previous</a>
      </li>
    {% endif %}

    <li class="page-item disabled">
      <a class="page-link">Page {{ users.number }} of {{ users.paginator.num_pages }}</a>
    </li>

    {% if users.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ users.next_page_number }}&search={{ search_query }}">Next</a>
      </li>
    {% endif %}
  </ul>
</nav>


<!-- Approvals Section -->
<h4 class="section-title">Pending Approvals</h4>
<div class="row approval-section">
  <div class="col-md-4 mb-3">
    <div class="card p-3">
      <h5>Courses</h5>
      {% if pending_courses %}
        <ul>
          {% for course in pending_courses %}
            <li>{{ course.title }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No pending courses.</p>
      {% endif %}
    </div>
  </div>

  <div class="col-md-4 mb-3">
    <div class="card p-3">
      <h5>Results</h5>
      {% if pending_results %}
        <ul>
          {% for result in pending_results %}
            <li>{{ result.student_name }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No pending results.</p>
      {% endif %}
    </div>
  </div>

  <div class="col-md-4 mb-3">
    <div class="card p-3">
      <h5>Payments</h5>
      {% if pending_payments %}
        <ul>
          {% for payment in pending_payments %}
            <li>{{ payment.student_name }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No pending payments.</p>
      {% endif %}
    </div>
  </div>
</div>

<div class="text-center mt-4">
  <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
</div>

<script>
  function toggleDropdown(id) {
    const section = document.getElementById(id);
    if (section.style.display === "block") {
      section.style.display = "none";
    } else {
      section.style.display = "block";
      section.scrollIntoView({ behavior: 'smooth' });
    }
  }
</script>
{% endblock %}
